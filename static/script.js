const translations = {
    km: {
        nav_home: "áž‘áŸ†áž–áŸážšážŠáž¾áž˜",
        nav_tools: "áž§áž”áž€ážšážŽáŸ",
        nav_billing: "áž€áž¶ážšáž‘áž¼áž‘áž¶ážáŸ‹",
        nav_profile: "áž‚ážŽáž“áž¸",
        nav_logout: "áž…áž¶áž€áž…áŸáž‰",
        nav_login: "áž…áž¼áž›",
        hero_title: "áž§áž”áž€ážšážŽáŸ Telegram áž€áŸ†áž–áž¼áž›",
        hero_subtitle: "áž”áž„áŸ’áž€áž¾áž“áž”áž‘áž–áž·ážŸáŸ„áž’áž“áŸ Telegram ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€áž‡áž¶áž˜áž½áž™áž§áž”áž€ážšážŽáŸáž€áž˜áŸ’ážšáž·ážážáŸ’áž–ážŸáŸ‹ážŸáž˜áŸ’ážšáž¶áž”áŸ‹áž€áž¶ážšáž‚áŸ’ážšáž”áŸ‹áž‚áŸ’ážšáž„ ážŸáŸ’ážœáŸáž™áž”áŸ’ážšážœážáŸ’ážáž·áž€áž˜áŸ’áž˜ áž“áž·áž„áž˜áž¶ážáž·áž€áž¶áŸ” ážšáž…áž“áž¶áž¡áž¾áž„ážŠáŸ„áž™áž—áž¶áž–ážŸáŸ’ážšážŸáŸ‹ážŸáŸ’áž¢áž¶ážáž”áŸ‚áž” áž¢áž”áŸ’ážŸážšáž¶ážáŸ’áž˜áŸ‚ážšáŸ”",
        btn_get_started: "áž…áž¶áž”áŸ‹áž•áŸ’ážáž¾áž˜",
        btn_dashboard: "áž‘áŸ…áž€áž¶áž“áŸ‹áž•áŸ’áž‘áž¶áŸ†áž„áž‚áŸ’ážšáž”áŸ‹áž‚áŸ’ážšáž„",
        feat_vid_title: "áž€áž˜áŸ’áž˜ážœáž·áž’áž¸áž‘áž¶áž‰áž™áž€ážœáž¸ážŠáŸáž¢áž¼",
        feat_vid_desc: "áž‘áž¶áž‰áž™áž€ážœáž¸ážŠáŸáž¢áž¼áž‚áž»ážŽáž—áž¶áž–ážáŸ’áž–ážŸáŸ‹ážŠáŸ„áž™áž•áŸ’áž‘áž¶áž›áŸ‹áž–áž¸áž”áŸ‰áž»ážŸáŸ’ážáž·áŸ áž“áž·áž„áž€áŸ’ážšáž»áž˜ Telegram áŸ” áž›áž¿áž“ ážŸáž»ážœážáŸ’ážáž·áž—áž¶áž– áž“áž·áž„áž„áž¶áž™ážŸáŸ’ážšáž½áž›áž”áŸ’ážšáž¾áŸ”",
        btn_vid_tool: "áž§áž”áž€ážšážŽáŸáž‘áž¶áž‰áž™áž€",
        feat_scrap_title: "áž€áž˜áŸ’áž˜ážœáž·áž’áž¸ Scraper ážŸáž˜áž¶áž‡áž·áž€",
        feat_scrap_desc: "áž“áž¶áŸ†áž…áŸáž‰ážŸáž˜áž¶áž‡áž·áž€ážŸáž€áž˜áŸ’áž˜áž–áž¸áž€áŸ’ážšáž»áž˜áž‘áŸ…áž‡áž¶ CSV áŸ” ážáŸ’ážšáž„ážáž¶áž˜ážŸáž€áž˜áŸ’áž˜áž—áž¶áž– áž“áž·áž„áž‚áŸ’ážšáž”áŸ‹áž‚áŸ’ážšáž„áž€áž¶ážšážšáž¸áž€áž…áž˜áŸ’ážšáž¾áž“ážŸáž áž‚áž˜áž“áŸážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€áŸ”",
        btn_scrap_tool: "áž§áž”áž€ážšážŽáŸ Scraper",
        feat_add_title: "áž”áž“áŸ’ážáŸ‚áž˜ážŸáž˜áž¶áž‡áž·áž€ážŸáŸ’ážœáŸáž™áž”áŸ’ážšážœážáŸ’ážáž·",
        feat_add_desc: "áž”áž“áŸ’ážáŸ‚áž˜ážŸáž˜áž¶áž‡áž·áž€áž‘áŸ…áž”áŸ‰áž»ážŸáŸ’ážáž·áŸ áž¬áž€áŸ’ážšáž»áž˜ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€ážŠáŸ„áž™ážŸáŸ’ážœáŸáž™áž”áŸ’ážšážœážáŸ’ážáž·áž–áž¸áž”áž‰áŸ’áž‡áž¸ážŠáŸ‚áž›áž”áž¶áž“ Scrape áŸ”",
        btn_add_tool: "áž§áž”áž€ážšážŽáŸáž”áž“áŸ’ážáŸ‚áž˜ážŸáž˜áž¶áž‡áž·áž€",
        feat_anal_title: "ážœáž·áž—áž¶áž‚áž€áž˜áŸ’ážšáž·ážážáŸ’áž–ážŸáŸ‹",
        feat_anal_desc: "ážáž¶áž˜ážŠáž¶áž“áž€áž¶ážšážšáž¸áž€áž…áž˜áŸ’ážšáž¾áž“ áž”áŸ’ážšážœážáŸ’ážáž·áž‘áž¶áž‰áž™áž€ áž“áž·áž„áž¢ážáŸ’ážšáž¶áž‡áŸ„áž‚áž‡áŸáž™ážŸáŸ’ážœáŸáž™áž”áŸ’ážšážœážáŸ’ážáž·áž€áž˜áŸ’áž˜áž“áŸ…áž€áŸ’áž“áž»áž„áž•áŸ’áž‘áž¶áŸ†áž„áž‚áŸ’ážšáž”áŸ‹áž‚áŸ’ážšáž„ážáŸ‚áž˜áž½áž™áŸ”",
        btn_anal_tool: "áž˜áž¾áž›áž€áž¶ážšážœáž·áž—áž¶áž‚"
    },
    en: {
        nav_home: "Home",
        nav_tools: "Tools",
        nav_billing: "Billing",
        nav_profile: "Profile",
        nav_logout: "Logout",
        nav_login: "Sign In",
        hero_title: "The Ultimate Telegram Toolkit",
        hero_subtitle: "Empower your Telegram experience with premium tools for management, automation, and content. Designed with the elegance of Khmer Apsara.",
        btn_get_started: "Get Started",
        btn_dashboard: "Go to Dashboard",
        feat_vid_title: "Video Downloader",
        feat_vid_desc: "Download high-quality videos directly from Telegram channels and groups. Fast, secure, and easy to use.",
        btn_vid_tool: "Downloader Tool",
        feat_scrap_title: "Member Scraper",
        feat_scrap_desc: "Export active members from groups to CSV. Filter by activity and manage your community growth.",
        btn_scrap_tool: "Scraper Tool",
        feat_add_title: "Auto-Add Members",
        feat_add_desc: "Automatically add members to your channel or group from your scraped lists.",
        btn_add_tool: "Add Members Tool",
        feat_anal_title: "Premium Analytics",
        feat_anal_desc: "Track your growth, download history, and automation success rates in one dashboard.",
        btn_anal_tool: "View Analytics"
    },
    hi: {
        nav_home: "à¤¹à¥‹à¤®",
        nav_tools: "à¤‰à¤ªà¤•à¤°à¤£",
        nav_billing: "à¤¬à¤¿à¤²à¤¿à¤‚à¤—",
        nav_profile: "à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤²",
        nav_logout: "à¤²à¥‰à¤— à¤†à¤‰à¤Ÿ",
        nav_login: "à¤¸à¤¾à¤‡à¤¨ à¤‡à¤¨",
        hero_title: "à¤…à¤‚à¤¤à¤¿à¤® à¤Ÿà¥‡à¤²à¥€à¤—à¥à¤°à¤¾à¤® à¤Ÿà¥‚à¤²à¤•à¤¿à¤Ÿ",
        hero_subtitle: "à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨, à¤¸à¥à¤µà¤šà¤¾à¤²à¤¨ à¤”à¤° à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¥à¤°à¥€à¤®à¤¿à¤¯à¤® à¤Ÿà¥‚à¤² à¤•à¥‡ à¤¸à¤¾à¤¥ à¤…à¤ªà¤¨à¥‡ à¤Ÿà¥‡à¤²à¥€à¤—à¥à¤°à¤¾à¤® à¤…à¤¨à¥à¤­à¤µ à¤•à¥‹ à¤¸à¤¶à¤•à¥à¤¤ à¤¬à¤¨à¤¾à¤à¤‚à¥¤",
        btn_get_started: "à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚",
        btn_dashboard: "à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡ à¤ªà¤° à¤œà¤¾à¤à¤‚",
        feat_vid_title: "à¤µà¥€à¤¡à¤¿à¤¯à¥‹ à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡à¤°",
        feat_vid_desc: "à¤¸à¥€à¤§à¥‡ à¤Ÿà¥‡à¤²à¥€à¤—à¥à¤°à¤¾à¤® à¤šà¥ˆà¤¨à¤²à¥‹à¤‚ à¤”à¤° à¤¸à¤®à¥‚à¤¹à¥‹à¤‚ à¤¸à¥‡ à¤‰à¤šà¥à¤š à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤µà¤¾à¤²à¥‡ à¤µà¥€à¤¡à¤¿à¤¯à¥‹ à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚à¥¤",
        btn_vid_tool: "à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡à¤° à¤Ÿà¥‚à¤²",
        feat_scrap_title: "à¤¸à¤¦à¤¸à¥à¤¯ à¤¸à¥à¤•à¥à¤°à¥ˆà¤ªà¤°",
        feat_scrap_desc: "à¤¸à¤®à¥‚à¤¹à¥‹à¤‚ à¤¸à¥‡ à¤¸à¤•à¥à¤°à¤¿à¤¯ à¤¸à¤¦à¤¸à¥à¤¯à¥‹à¤‚ à¤•à¥‹ CSV à¤®à¥‡à¤‚ à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤ à¤•à¤°à¥‡à¤‚à¥¤",
        btn_scrap_tool: "à¤¸à¥à¤•à¥à¤°à¥ˆà¤ªà¤° à¤Ÿà¥‚à¤²",
        feat_add_title: "à¤¸à¤¦à¤¸à¥à¤¯ à¤‘à¤Ÿà¥‹-à¤à¤¡",
        feat_add_desc: "à¤…à¤ªà¤¨à¥€ à¤¸à¥à¤•à¥à¤°à¥ˆà¤ª à¤•à¥€ à¤—à¤ˆ à¤¸à¥‚à¤šà¥€ à¤¸à¥‡ à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤°à¥‚à¤ª à¤¸à¥‡ à¤¸à¤¦à¤¸à¥à¤¯à¥‹à¤‚ à¤•à¥‹ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚à¥¤",
        btn_add_tool: "à¤¸à¤¦à¤¸à¥à¤¯ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
        feat_anal_title: "à¤ªà¥à¤°à¥€à¤®à¤¿à¤¯à¤® à¤à¤¨à¤¾à¤²à¤¿à¤Ÿà¤¿à¤•à¥à¤¸",
        feat_anal_desc: "à¤à¤• à¤¹à¥€ à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡ à¤®à¥‡à¤‚ à¤…à¤ªà¤¨à¥€ à¤µà¥ƒà¤¦à¥à¤§à¤¿ à¤”à¤° à¤‡à¤¤à¤¿à¤¹à¤¾à¤¸ à¤•à¥‹ à¤Ÿà¥à¤°à¥ˆà¤• à¤•à¤°à¥‡à¤‚à¥¤",
        btn_anal_tool: "à¤à¤¨à¤¾à¤²à¤¿à¤Ÿà¤¿à¤•à¥à¤¸ à¤¦à¥‡à¤–à¥‡à¤‚"
    },
    id: {
        nav_home: "Beranda",
        nav_tools: "Alat",
        nav_billing: "Tagihan",
        nav_profile: "Profil",
        nav_logout: "Keluar",
        nav_login: "Masuk",
        hero_title: "Toolkit Telegram Terbaik",
        hero_subtitle: "Tingkatkan pengalaman Telegram Anda dengan alat premium untuk manajemen dan otomasi.",
        btn_get_started: "Mulai",
        btn_dashboard: "Ke Dasbor",
        feat_vid_title: "Pengunduh Video",
        feat_vid_desc: "Unduh video berkualitas tinggi langsung dari saluran dan grup Telegram.",
        btn_vid_tool: "Alat Pengunduh",
        feat_scrap_title: "Scraper Anggota",
        feat_scrap_desc: "Ekspor anggota aktif dari grup ke CSV.",
        btn_scrap_tool: "Alat Scraper",
        feat_add_title: "Tambah Anggota Otomatis",
        feat_add_desc: "Tambahkan anggota secara otomatis ke grup Anda.",
        btn_add_tool: "Alat Tambah Anggota",
        feat_anal_title: "Analitik Premium",
        feat_anal_desc: "Lacak pertumbuhan dan riwayat Anda dalam satu dasbor.",
        btn_anal_tool: "Lihat Analitik"
    },
    fr: {
        nav_home: "Accueil",
        nav_tools: "Outils",
        nav_billing: "Facturation",
        nav_profile: "Profil",
        nav_logout: "DÃ©connexion",
        nav_login: "Se connecter",
        hero_title: "La BoÃ®te Ã  Outils Telegram Ultime",
        hero_subtitle: "AmÃ©liorez votre expÃ©rience Telegram avec des outils premium pour la gestion et l'automatisation.",
        btn_get_started: "Commencer",
        btn_dashboard: "Aller au tableau de bord",
        feat_vid_title: "TÃ©lÃ©chargeur VidÃ©o",
        feat_vid_desc: "TÃ©lÃ©chargez des vidÃ©os de haute qualitÃ© directement depuis les groupes Telegram.",
        btn_vid_tool: "Outil de TÃ©lÃ©chargement",
        feat_scrap_title: "Scraper de Membres",
        feat_scrap_desc: "Exportez les membres actifs des groupes vers CSV.",
        btn_scrap_tool: "Outil de Scraping",
        feat_add_title: "Ajout Auto de Membres",
        feat_add_desc: "Ajoutez automatiquement des membres Ã  votre canal ou groupe.",
        btn_add_tool: "Ajouter des Membres",
        feat_anal_title: "Analytique Premium",
        feat_anal_desc: "Suivez votre croissance et votre historique dans un seul tableau de bord.",
        btn_anal_tool: "Voir les Analytiques"
    },
    ms: {
        nav_home: "Laman Utama",
        nav_tools: "Alat",
        nav_billing: "Pengebilan",
        nav_profile: "Profil",
        nav_logout: "Log Keluar",
        nav_login: "Log Masuk",
        hero_title: "Kit Alat Telegram Terunggul",
        hero_subtitle: "Perkasakan pengalaman Telegram anda dengan alat premium.",
        btn_get_started: "Mula Sekarang",
        btn_dashboard: "Pergi ke Papan Pemuka",
        feat_vid_title: "Pemuat Turun Video",
        feat_vid_desc: "Muat turun video berkualiti tinggi terus dari saluran Telegram.",
        btn_vid_tool: "Alat Pemuat Turun",
        feat_scrap_title: "Pengocek Ahli",
        feat_scrap_desc: "Eksport ahli aktif dari kumpulan ke CSV.",
        btn_scrap_tool: "Alat Pengocek",
        feat_add_title: "Tambah Ahli Auto",
        feat_add_desc: "Tambah ahli secara automatik ke saluran atau kumpulan anda.",
        btn_add_tool: "Alat Tambah Ahli",
        feat_anal_title: "Analitik Premium",
        feat_anal_desc: "Jejaki pertumbuhan anda dalam satu papan pemuka.",
        btn_anal_tool: "Lihat Analitik"
    },
    zh: {
        nav_home: "é¦–é¡µ",
        nav_tools: "å·¥å…·",
        nav_billing: "è´¦å•",
        nav_profile: "ä¸ªäººèµ„æ–™",
        nav_logout: "ç™»å‡º",
        nav_login: "ç™»å½•",
        hero_title: "ç»ˆæž Telegram å·¥å…·åŒ…",
        hero_subtitle: "ä½¿ç”¨é«˜çº§ç®¡ç†å’Œè‡ªåŠ¨åŒ–å·¥å…·å¢žå¼ºæ‚¨çš„ Telegram ä½“éªŒã€‚",
        btn_get_started: "å¼€å§‹ä½¿ç”¨",
        btn_dashboard: "å‰å¾€ä»ªè¡¨æ¿",
        feat_vid_title: "è§†é¢‘ä¸‹è½½å™¨",
        feat_vid_desc: "ç›´æŽ¥ä»Ž Telegram é¢‘é“å’Œç¾¤ç»„ä¸‹è½½é«˜è´¨é‡è§†é¢‘ã€‚",
        btn_vid_tool: "ä¸‹è½½å·¥å…·",
        feat_scrap_title: "æˆå‘˜é‡‡é›†å™¨",
        feat_scrap_desc: "å°†æ´»è·ƒæˆå‘˜ä»Žç¾¤ç»„å¯¼å‡ºä¸º CSVã€‚",
        btn_scrap_tool: "é‡‡é›†å·¥å…·",
        feat_add_title: "è‡ªåŠ¨æ·»åŠ æˆå‘˜",
        feat_add_desc: "è‡ªåŠ¨å°†æˆå‘˜æ·»åŠ åˆ°æ‚¨çš„é¢‘é“æˆ–ç¾¤ç»„ã€‚",
        btn_add_tool: "æ·»åŠ æˆå‘˜å·¥å…·",
        feat_anal_title: "é«˜çº§åˆ†æž",
        feat_anal_desc: "åœ¨ä¸€ä¸ªä»ªè¡¨æ¿ä¸­è·Ÿè¸ªæ‚¨çš„å¢žé•¿å’ŒåŽ†å²è®°å½•ã€‚",
        btn_anal_tool: "æŸ¥çœ‹åˆ†æž"
    },
    vn: {
        nav_home: "Trang chá»§",
        nav_tools: "CÃ´ng cá»¥",
        nav_billing: "Thanh toÃ¡n",
        nav_profile: "Há»“ sÆ¡",
        nav_logout: "ÄÄƒng xuáº¥t",
        nav_login: "ÄÄƒng nháº­p",
        hero_title: "Bá»™ cÃ´ng cá»¥ Telegram Tá»‘i thÆ°á»£ng",
        hero_subtitle: "NÃ¢ng cao tráº£i nghiá»‡m Telegram cá»§a báº¡n vá»›i cÃ¡c cÃ´ng cá»¥ cao cáº¥p.",
        btn_get_started: "Báº¯t Ä‘áº§u",
        btn_dashboard: "Äi tá»›i Báº£ng Ä‘iá»u khiá»ƒn",
        feat_vid_title: "TrÃ¬nh táº£i video",
        feat_vid_desc: "Táº£i xuá»‘ng video cháº¥t lÆ°á»£ng cao trá»±c tiáº¿p tá»« cÃ¡c kÃªnh Telegram.",
        btn_vid_tool: "CÃ´ng cá»¥ Táº£i xuá»‘ng",
        feat_scrap_title: "TrÃ¬nh quÃ©t thÃ nh viÃªn",
        feat_scrap_desc: "Xuáº¥t thÃ nh viÃªn Ä‘ang hoáº¡t Ä‘á»™ng tá»« cÃ¡c nhÃ³m sang CSV.",
        btn_scrap_tool: "CÃ´ng cá»¥ QuÃ©t",
        feat_add_title: "Tá»± Ä‘á»™ng thÃªm thÃ nh viÃªn",
        feat_add_desc: "Tá»± Ä‘á»™ng thÃªm thÃ nh viÃªn vÃ o kÃªnh hoáº·c nhÃ³m cá»§a báº¡n.",
        btn_add_tool: "CÃ´ng cá»¥ ThÃªm thÃ nh viÃªn",
        feat_anal_title: "PhÃ¢n tÃ­ch cao cáº¥p",
        feat_anal_desc: "Theo dÃµi sá»± phÃ¡t triá»ƒn cá»§a báº¡n trong má»™t báº£ng Ä‘iá»u khiá»ƒn.",
        btn_anal_tool: "Xem PhÃ¢n tÃ­ch"
    }
};

function changeLanguage(lang) {
    localStorage.setItem('apsara_lang', lang);
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.innerText = translations[lang][key];
        }
    });

    // Update select value if exists
    const langSelect = document.getElementById('lang-select');
    if (langSelect) {
        langSelect.value = lang;
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // Language Init
    const savedLang = localStorage.getItem('apsara_lang') || 'km'; // Default to Khmer

    // Create Language Selector if Nav exists
    const navLinks = document.querySelector('.nav-links');
    if (navLinks && !document.getElementById('lang-select')) {
        const select = document.createElement('select');
        select.id = 'lang-select';
        select.className = 'btn btn-outline';
        select.style.marginRight = '10px';
        select.style.padding = '5px';
        select.onchange = (e) => changeLanguage(e.target.value);

        const languages = [
            { code: 'km', name: 'ðŸ‡°ðŸ‡­ Khmer' },
            { code: 'en', name: 'ðŸ‡ºðŸ‡¸ English' },
            { code: 'hi', name: 'ðŸ‡®ðŸ‡³ Hindi' },
            { code: 'id', name: 'ðŸ‡®ðŸ‡© Indonesia' },
            { code: 'fr', name: 'ðŸ‡«ðŸ‡· French' },
            { code: 'ms', name: 'ðŸ‡²ðŸ‡¾ Malay' },
            { code: 'zh', name: 'ðŸ‡¨ðŸ‡³ Chinese' },
            { code: 'vn', name: 'ðŸ‡»ðŸ‡³ Vietnam' }
        ];

        languages.forEach(l => {
            const option = document.createElement('option');
            option.value = l.code;
            option.text = l.name;
            select.appendChild(option);
        });

        // Insert before profile/login buttons usually. 
        // Let's prepend to ensure it's visible.
        navLinks.insertBefore(select, navLinks.firstChild);
    }

    // Apply translations
    changeLanguage(savedLang);

    // Initialize Toast Container if not exists
    if (!document.querySelector('.toast-container')) {
        const container = document.createElement('div');
        container.className = 'toast-container';
        document.body.appendChild(container);
    }

    // Avatar Upload Logic
    const avatarContainer = document.getElementById('avatar-container');
    const avatarInput = document.getElementById('avatar-input');
    const avatarOverlay = document.getElementById('avatar-overlay');

    if (avatarContainer && avatarInput) {
        avatarContainer.addEventListener('click', () => avatarInput.click());

        avatarContainer.addEventListener('mouseover', () => avatarOverlay.style.opacity = '1');
        avatarContainer.addEventListener('mouseout', () => avatarOverlay.style.opacity = '0');

        avatarInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            try {
                showToast("Uploading", "Updating profile picture...", "success");
                const response = await fetch('/api/profile/upload-avatar', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.status === 'success') {
                    // Update Image Source
                    const img = document.getElementById('profile-img');
                    if (img) {
                        img.src = data.url;
                    } else {
                        window.location.reload();
                    }
                    showToast("Success", "Profile picture updated!", "success");
                } else {
                    showToast("Error", "Upload failed: " + data.message, "error");
                }
            } catch (err) {
                console.error(err);
                showToast("Error", "Upload failed.", "error");
            }
        });
    }
});

function showToast(title, message, type = 'success') {
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container';
        document.body.appendChild(container);
    }

    const toast = document.createElement('div');
    toast.className = `toast ${type === 'error' ? 'toast-error' : 'toast-success'}`;

    toast.innerHTML = `
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
        <button style="background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:1.2rem;" onclick="this.parentElement.remove()">Ã—</button>
    `;

    container.appendChild(toast);

    // Auto remove
    setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s ease-out forwards';
        setTimeout(() => toast.remove(), 300);
    }, 5000);
}

async function updateProfile() {
    const fullName = document.getElementById('full_name').value;
    const currentPass = document.getElementById('current_password').value;
    const newPass = document.getElementById('new_password').value;
    const confirmPass = document.getElementById('confirm_password').value;

    const formData = new FormData();
    formData.append('full_name', fullName);
    if (currentPass) formData.append('password', currentPass);
    if (newPass) formData.append('new_password', newPass);
    if (confirmPass) formData.append('confirm_password', confirmPass);

    try {
        const response = await fetch('/api/profile/update', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();

        if (data.status === 'success') {
            showToast("Success", data.message, "success");
            document.getElementById('current_password').value = '';
            document.getElementById('new_password').value = '';
            document.getElementById('confirm_password').value = '';
        } else {
            showToast("Error", data.message, "error");
        }
    } catch (err) {
        showToast("Error", "Failed to update profile", "error");
    }
}

function checkStrength() {
    const pass = document.getElementById('new_password').value;
    const bar = document.getElementById('strength-bar');
    const text = document.getElementById('strength-text');

    let strength = 0;
    if (pass.length > 5) strength += 20;
    if (pass.match(/[A-Z]/)) strength += 20;
    if (pass.match(/[0-9]/)) strength += 20;
    if (pass.match(/[^a-zA-Z0-9]/)) strength += 20;
    if (pass.length > 10) strength += 20;

    bar.style.width = strength + '%';

    if (strength < 40) {
        bar.style.background = 'var(--secondary-red)';
        text.innerText = "Weak";
        text.style.color = 'var(--secondary-red)';
    } else if (strength < 80) {
        bar.style.background = 'orange';
        text.innerText = "Medium";
        text.style.color = 'orange';
    } else {
        bar.style.background = '#4ade80';
        text.innerText = "Strong";
        text.style.color = '#4ade80';
    }
}
