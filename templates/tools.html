<div
    style="width: 100%; background: #000; display: flex; align-items: center; justify-content: center; margin-top: 1rem; border-radius: 8px; overflow: hidden;">
    <video id="video-player" controls style="width: 100%; max-height: 400px; display: none;"></video>
</div>
<a id="download-link" href="#" class="btn btn-primary"
    style="margin-top: 1rem; width: 100%; text-align: center; display: block;" download>Recursive
    Download</a>
</div>
</div>

<!-- Log Output Area -->
<div id="log-container" class="card"
    style="margin-top: 2rem; display: none; background: #0f172a; border: 1px solid var(--primary-gold);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3 style="color: var(--primary-gold); font-family: monospace;">> Console Output</h3>
        <button onclick="clearLogs()" class="btn btn-sm btn-outline"
            style="padding: 0.2rem 0.5rem; font-size: 0.8rem;">Clear</button>
    </div>
    <div id="log-content" style="
            font-family: monospace; 
            color: #10b981; 
            background: rgba(0,0,0,0.3); 
            padding: 1rem; 
            border-radius: 4px; 
            max-height: 300px; 
            overflow-y: auto; 
            white-space: pre-wrap; 
            font-size: 0.9rem;"></div>
</div>

</div>
const statusArea = document.getElementById('status-area');
const statusText = document.getElementById('status-text');
const progressBar = document.getElementById('progress-bar');
const previewArea = document.getElementById('preview-area');
const videoPlayer = document.getElementById('video-player');
const downloadLink = document.getElementById('download-link');

// Reset UI
submitBtn.disabled = true;
submitBtn.innerText = "Downloading...";
statusArea.style.display = 'block';
previewArea.style.display = 'none';
progressBar.style.width = '30%'; // Fake progress start
statusText.innerText = "Connecting to Telegram...";

try {
const response = await fetch('/api/tools/download', {
method: 'POST',
body: formData
});

const result = await response.json();

if (result.status === 'success') {
progressBar.style.width = '100%';
statusText.innerText = "Download Complete!";

// Show Video
previewArea.style.display = 'block';
videoPlayer.src = result.file_path;
videoPlayer.style.display = 'block';
downloadLink.href = result.file_path;
} else {
statusText.innerText = "Error: " + result.message;
progressBar.style.width = '0%';
progressBar.style.background = 'red';
}

} catch (error) {
console.error('Error:', error);
statusText.innerText = "Network Error Occurred.";
} finally {
submitBtn.disabled = false;
submitBtn.innerText = "Download Video";
}
}
</script>
{% endblock %}