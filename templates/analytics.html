{% extends "base.html" %}

{% block title %}Premium Analytics - Apsara Premium{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem;">
    <!-- Hero / Marketing Blurb -->
    <div class="card" style="margin-bottom: 3rem; text-align: center; border-left: 4px solid var(--primary-gold);">
        <h1
            style="margin-bottom: 1rem; font-size: 2.5rem; background: var(--gold-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
            Unlock the Full Potential
        </h1>
        <p style="color: var(--text-light); font-size: 1.1rem; line-height: 1.6; max-width: 800px; margin: 0 auto;">
            Our all-in-one dashboard brings together your growth metrics, download history, and automation success rates
            into a single, easy-to-use interface. Whether you’re tracking progress or optimizing performance, Premium
            Analytics provides the clarity and insights you need to make smarter, faster decisions.
        </p>
    </div>

    <!-- Quick Stats Grid -->
    <div class="grid-cols-2" style="gap: 1.5rem; margin-bottom: 2rem;">
        <div class="card animate-float" style="padding: 1.5rem; text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.9rem;">Total Downloads</p>
            <h2 style="font-size: 2.5rem; margin-top: 0.5rem;">1,248</h2>
            <span style="color: #4ade80; font-size: 0.8rem;">▲ 12% this week</span>
        </div>
        <div class="card animate-float" style="padding: 1.5rem; text-align: center; animation-delay: 0.2s;">
            <p style="color: var(--text-muted); font-size: 0.9rem;">Automation Success Rate</p>
            <h2 style="font-size: 2.5rem; margin-top: 0.5rem;">98.5%</h2>
            <span style="color: var(--primary-gold); font-size: 0.8rem;">● Stable Performance</span>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="grid-cols-2" style="gap: 2rem; margin-bottom: 3rem;">
        <!-- Growth Chart -->
        <div class="card">
            <h3 style="margin-bottom: 1.5rem; font-size: 1.2rem;">Growth Monitoring</h3>
            <canvas id="growthChart" height="200"></canvas>
        </div>
        <!-- Success Chart -->
        <div class="card">
            <h3 style="margin-bottom: 1.5rem; font-size: 1.2rem;">Automation Success</h3>
            <div style="width: 70%; margin: 0 auto;">
                <canvas id="successChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Scraped Data Explorer -->
    <div class="card" style="margin-bottom: 3rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>Scraped Data Explorer</h3>
            <div style="position: relative; width: 300px;">
                <input type="text" id="csvSearch" placeholder="Filter by Name, Username or ID..." class="form-input"
                    style="padding-left: 35px; background: rgba(0,0,0,0.3);">
                <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-muted);"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>

        {% if csv_data %}
        <div style="overflow-x: auto; max-height: 500px; overflow-y: auto;">
            <table class="table" style="width: 100%; border-collapse: collapse; color: var(--text-light);"
                id="csvTable">
                <thead>
                    <tr
                        style="border-bottom: 1px solid rgba(255, 215, 0, 0.2); text-align: left; position: sticky; top: 0; background: #1e293b; z-index: 10;">
                        {% for header in csv_headers %}
                        <th style="padding: 1rem; color: var(--primary-gold); white-space: nowrap;">{{ header }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in csv_data %}
                    <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05); transition: background 0.2s;"
                        class="csv-row">
                        {% for cell in row %}
                        <td style="padding: 1rem; white-space: nowrap;">{{ cell }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <p id="noResults" style="text-align: center; color: var(--text-muted); padding: 2rem; display: none;">No
            matching records found.</p>
        {% else %}
        <div
            style="text-align: center; padding: 2rem; border: 1px dashed rgba(255,255,255,0.1); border-radius: var(--radius-md);">
            <p style="color: var(--text-muted);">No data found. Run the <strong>Member Scraper</strong> tool to populate
                this table.</p>
            <a href="/tools" class="btn btn-primary" style="margin-top: 1rem;">Go to Tools</a>
        </div>
        {% endif %}
    </div>

    <!-- Download History Table -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>Recent Activity</h3>
            <button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem 1rem;">Export Report</button>
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; color: var(--text-light);">
                <thead>
                    <tr style="border-bottom: 1px solid rgba(255, 215, 0, 0.2); text-align: left;">
                        <th style="padding: 1rem; color: var(--primary-gold);">Date</th>
                        <th style="padding: 1rem; color: var(--primary-gold);">Action</th>
                        <th style="padding: 1rem; color: var(--primary-gold);">File Type</th>
                        <th style="padding: 1rem; color: var(--primary-gold);">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                        <td style="padding: 1rem;">Dec 09, 2025</td>
                        <td style="padding: 1rem;">Video Download</td>
                        <td style="padding: 1rem;">MP4 (HD)</td>
                        <td style="padding: 1rem;"><span style="color: #4ade80;">Completed</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                        <td style="padding: 1rem;">Dec 09, 2025</td>
                        <td style="padding: 1rem;">Member Scrape</td>
                        <td style="padding: 1rem;">CSV</td>
                        <td style="padding: 1rem;"><span style="color: #4ade80;">Completed</span></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                        <td style="padding: 1rem;">Dec 08, 2025</td>
                        <td style="padding: 1rem;">Auto-Add</td>
                        <td style="padding: 1rem;">-</td>
                        <td style="padding: 1rem;"><span style="color: var(--secondary-red);">Failed</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 1rem;">Dec 08, 2025</td>
                        <td style="padding: 1rem;">Video Download</td>
                        <td style="padding: 1rem;">MKV</td>
                        <td style="padding: 1rem;"><span style="color: #4ade80;">Completed</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Initialize Charts
    const ctxGrowth = document.getElementById('growthChart').getContext('2d');
    const ctxSuccess = document.getElementById('successChart').getContext('2d');

    // Gradient for Line Chart
    let gradient = ctxGrowth.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(255, 215, 0, 0.4)');
    gradient.addColorStop(1, 'rgba(255, 215, 0, 0.0)');

    new Chart(ctxGrowth, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Downloads',
                data: [12, 19, 15, 25, 22, 30, 45],
                borderColor: '#FFD700',
                backgroundColor: gradient,
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#FFF',
                pointBorderColor: '#FFD700'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    grid: { color: 'rgba(255, 255, 255, 0.05)' },
                    ticks: { color: '#94A3B8' }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: '#94A3B8' }
                }
            }
        }
    });

    new Chart(ctxSuccess, {
        type: 'doughnut',
        data: {
            labels: ['Success', 'Failed'],
            datasets: [{
                data: [98.5, 1.5],
                backgroundColor: ['#4ade80', '#ef4444'],
                borderWidth: 0,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#94A3B8' }
                }
            }
        }
    });

    // CSV Filtering Logic
    const searchInput = document.getElementById('csvSearch');
    if (searchInput) {
        searchInput.addEventListener('keyup', function () {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('.csv-row');
            let hasVisible = false;

            rows.forEach(row => {
                const cells = row.getElementsByTagName('td');
                let match = false;
                for (let i = 0; i < cells.length; i++) {
                    if (cells[i].textContent.toLowerCase().indexOf(filter) > -1) {
                        match = true;
                        break;
                    }
                }
                if (match) {
                    row.style.display = '';
                    hasVisible = true;
                } else {
                    row.style.display = 'none';
                }
            });

            const noResults = document.getElementById('noResults');
            if (noResults) {
                noResults.style.display = hasVisible ? 'none' : 'block';
            }
        });
    }
</script>
{% endblock %}